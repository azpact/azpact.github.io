<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="plugins/element-ui@2.12.0/theme-chalk/index.css"
    />
    <script src="plugins/jquery-3.4.1.js"></script>
    <script src="plugins/vue.min.js"></script>
    <script src="plugins/axios.js"></script>
    <script src="plugins/element-ui.js"></script>
    <style>
      /* * {
        outline: 1px solid red;
      } */
      body {
        overflow-x: hidden;
      }
      a{
        text-decoration: none;
        color:black
      }
      li {
        display: flex;
        height: 1rem;
        height: 1rem;
      }

      li div {
        margin-left: 0.3rem;
      }
      .features {
        display: flex;
      }
      .features i {
        width: 1.75rem;
        height: 1.75rem;
        line-height: 1.75rem;
        text-align: center;
        background-color: lightslategray;
        color: #fff;
        transition: all 0.2s;
        border-radius: 50%;
        margin-right: 0.3rem;
      }
      .features i::before {
        height: 1.75rem;
        line-height: 1.75rem;
      }
      .features i:hover {
        background-color: #fff;
        color: lightslategray;
        font-weight: bold;
      }

      .el-icon-warning,
      .el-icon-success {
        font-size: 1.5rem;
        height: 1.75rem;
        line-height: 1.75rem;
      }
      .el-icon-warning {
        color: #e6a23c;
      }
      .el-icon-success {
        color: #67c23a;
      }
      .saveBox {
        bottom: 5.6rem;
        left: 0;
        justify-content: left;
      }
      .messageBox {
        bottom: 8.8rem;
      }
      .saveBox,
      .messageBox {
        position: fixed;
        font-size: 0.8rem;
        left: 0;
        width: 100%;
        display: flex;
        text-align: center;
      }
      .saveBox > div,
      .messageBox > div {
        display: flex;
        align-items: center;
        background-color: salmon;
        width: 10rem;
        height: 3rem;
        opacity: 0.9;
      }
      .messageBox > div i {
        position: relative;
        float: right;
        font-size: 2rem;
        display: block;
        transition: all 0.3s;
        margin-right: 0.3rem;
      }
      .messageBox > div i:hover {
        transform: rotate(180deg);
      }
      .saveBox button {
        height: 1.5rem;
        line-height: 1.5rem;
        margin-right: 0.1rem;
      }
      .saveBox p {
        width: 100%;
        text-align: center;
      }
      .messageBox p {
        text-align: left;
        width: 100%;
        padding: 0 0.2rem;
      }
      .addImage {
        position: fixed;
        left: 0;
        bottom:8.6rem;
      }
      .addImage > img {
        max-width: 300px;
        border:2px solid black;
        border-radius: 5px;
      }
      .features-enter-active {
        animation: goFeatures 1s;
      }
      .features-leave-active {
        animation: backFeatures 1s;
      }
      .messageBox-enter-active {
        animation: goMessageBox 1s;
      }
      .messageBox-leave-active {
        animation: backMessageBox 1s;
      }

      #app {
        display: flex;
        flex-wrap: wrap;
      }
      #app > section:nth-child(1) {
        position: fixed;
        overflow-y: scroll;
        width: 40%;
        max-width: 320px;
        top: 0;
        left: 0;
        height: 100vh;
      }
      #app > section:nth-child(2) {
        margin-left: 320px;
        width: 100%;
      }
      #features {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 5rem;
        border: 5px solid rgb(200, 200, 200);
        background-color: rgb(248, 227, 177);
        transition: all 0.3s;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
      }
      #features:hover {
        border: 5px solid rgb(194, 163, 128);
      }
      #features > div:nth-child(1) {
        padding: 0 1rem;
      }

      #features > div:nth-child(1) > input:nth-of-type(1) {
        width: 2.5rem;
      }
      #features > div:nth-child(1) > input:nth-of-type(2) {
        width: 8rem;
      }
      #features > div:nth-child(1) div input {
        margin-top: 0.3rem;
        width: 79.7%;
      }
      #features .features button {
        margin: 0 0.2rem;
        border: none;
        background-color: rgb(194, 163, 128);
        color: #fff;
      }
      #features .features button:hover {
        border: none;
        background-color: #fff;
        color: rgb(194, 163, 128);
        transition: all 0.2s;
      }
      #features .features i {
        width: 1.5rem;
        height: 1.5rem;
        line-height: 1.5rem;
        margin-right: 0.3rem;
        text-align: center;
        color: #fff;
        background-color: rgb(194, 163, 128);
        border-radius: 50%;
        transition: all 0.2s;
      }
      #features .features i::before {
        height: 1.5rem;
        line-height: 1.5rem;
      }
      #features .features i:hover {
        background-color: #fff;
        color: rgb(194, 163, 128);
        font-weight: bold;
      }
      #showFeatures,
      #closeFeatures {
        position: fixed;
        right: 1rem;
        bottom: 4rem;
        color: #fff;
        background-color: rgb(194, 163, 128);
        width: 2rem;
        height: 2rem;
        line-height: 2rem;
        text-align: center;
        border-radius: 50%;
        font-size: 1.5rem;
        padding: 0.3rem;
        transition: all 0.3s;
      }
      #showFeatures:hover {
        box-shadow: 1px 1px 5px 1px #666;
      }
      #main {
        font-size: 0.7rem;
        padding: 0.5rem;
        color: #fff;
        background-color: rgb(41, 41, 41);
        margin: 0;
        letter-spacing: 0.11px;
      }     
      #main input {
        margin: 0;
        padding: 0;
        height: 1rem;
      }
      #main textarea,
      #main input{
        background-color: rgb(41, 41, 41); 
        color: #fff;
        border:none;
        outline: none;
      }
      #main input {
        margin-right: 1em;
        display:inline-block;      
      }
      #main input:nth-of-type(2n+1){
        width:38px;
      }
      #main input:nth-of-type(2n+2){
        width:200px;
      }
      #main button {
        font-size: 0.7rem;
        height: 1rem;
        border: none;
        background-color: rgb(41, 41, 41);
        color: #fff;
      }
      /*
      
      
      #main button:hover {
        border: none;
        background-color: rgb(194, 163, 128);
        color: #fff;
        transition: all 0.2s;
      }
      #main div:nth-of-type(2n + 2) {
        background-color: rgb(255, 246, 246);
      } */
      /* * {
        outline: 1px solid red;
      } */

      @keyframes goFeatures {
        from {
          opacity: 0;
          margin-bottom: -12%;
        }
        to {
          opacity: 1;
          margin-bottom: 0;
        }
      }
      @keyframes backFeatures {
        from {
          opacity: 1;
          margin-bottom: 0;
        }
        to {
          opacity: 0;
          margin-bottom: -12%;
        }
      }
      @keyframes goMessageBox {
        from {
          margin-left: -10%;
          opacity: 0;
        }
        to {
          margin-left: 0;
          opacity: 1;
        }
      }
      @keyframes backMessageBox {
        from {
          opacity: 1;
        }
        to {
          margin-bottom: 5%;
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <section>
        <h2>目錄</h2>
        <ul v-for="(item,index) in listOne" :key="item.id" style="padding:0">
          <li :style="item.style" @click="fFeaturesData(1,index)">
            <transition
              enter-active-class="text-enter-active"
              leave-active-class="text-leave-active"
            >
              <div style="display:flex">
                <a :href="item.labelLink">{{item.value}} {{item.label}}
                </a>
                <div
                  v-for="light in listLight"
                  :key="light.id"
                  v-if="item.status==light.check"
                  style="margin-top:-0.3rem;"
                >
                  <i :class="light.class"></i>
                </div>
              </div>
            </transition>
          </li>
        </ul>
        <div class="addImage" v-if="addImage !==' ' ">
          <img :src="addImage" alt="" />
        </div> 
        <div style="height:150vh">&nbsp;</div>     
      </section>
      <section style="width:100%;" id="main">
        <div v-for="(item,index) in listOne" :key="item.id">
          <div style="width:100%;margin-bottom:1.7rem;" @click="fFeaturesData(1,index)">
            <section style="display:flex;">
              <span :id="item.label">&nbsp;</span>
              <input type="text" v-model="item.value">
              <input  type="text" v-model="item.label"></input>
              <button v-if="!item.modify" @click="fFeaturesData(10,index)">
                修改
              </button>
              <button v-if="item.modify" @click="fFeaturesData(10,index)">
                完成
              </button>
            </section>
            <pre v-if="!item.modify">{{item.text}}</pre>
            <textarea
              v-if="item.modify"
              v-model="item.text"
              cols="63"
              rows="15"
            >
            </textarea>
          </div>
        </div>
      </section>
      <transition
        enter-active-class="features-enter-active"
        leave-active-class="features-leave-active"
      >
        <section id="features" v-if="features">
          <div>
            <label for="Value">Code: </label>
            <input type="text" v-model.lazy="addValue" />
            <label for="label">Label: </label>
            <input type="text" v-model.lazy="addLabel" />
            <div>
              <label for="">Image: </label>
              <input type="text" v-model.lazy="addImage" />
               <label for="">Link: &nbsp;</label>
              <input type="text" v-model="anchor" disabled="disabled">
            </div>
          </div>
          <div class="features">
            <button @click="fFeaturesData(2)">新增</button>
            <button @click="fFeaturesData(3)">修改</button>
            <i v-if="keybo == false" @click="keybo = !keybo" class="el-icon-view"></i>
            <i v-if="keybo == true" @click="keybo = !keybo" class="el-icon-view" style="color:red;background-color:#FFF;"></i>
            <i
              @click="fFeaturesData(5,index)"
              class="el-icon-s-opportunity"
              title="Modify"
            ></i>
            <i
              @click="fFeaturesData(6,index)"
              class="el-icon-caret-left"
              title="Left"
            ></i>
            <i
              @click="fFeaturesData(7,index)"
              class="el-icon-caret-right"
              title="Right"
            ></i>
            <i
              @click="fFeaturesData(8,index)"
              class="el-icon-caret-top"
              title="Top"
            ></i>
            <i
              @click="fFeaturesData(9,index)"
              class="el-icon-caret-bottom"
              title="Down"
            ></i>
            <i
              @click="fFeaturesData(4,index)"
              class="el-icon-delete"
              title="Delete"
            ></i>
          </div>
          <div id="closeFeatures">
            <i class="el-icon-download" @click="fFeatures()"></i>
          </div>
        </section>
      </transition>
      <!-- 以下OK -->
      <transition
        enter-active-class="features-enter-active"
        leave-active-class="features-leave-active"
      >
        <section id="showFeatures" v-if="!features" @click="fFeatures()">
          <i class="el-icon-upload2"></i>
        </section>
      </transition>
      <transition
        enter-active-class="messageBox-enter-active"
        leave-active-class="messageBox-leave-active"
      >
        <section class="messageBox" v-if="messageBox">
          <div>
            <p>
              {{inMessageBox}}
            </p>
            <i class="el-icon-circle-close" @click="fmessageBox(0)"></i>
          </div>
        </section>
      </transition>
      <transition
        enter-active-class="messageBox-enter-active"
        leave-active-class="messageBox-leave-active"
      >
        <section class="saveBox" v-if="saveBox">
          <div>
            <p>
              {{inSaveBox}}
            </p>
            <button v-if="!checkSaveBox" @click="fsaveBox(3)">Close</button>
            <button v-if="!checkSaveBox" @click="fsaveBox(2)">Save</button>
            <button v-if="checkSaveBox" @click="fsaveBox(4)">Yes</button>
            <button v-if="checkSaveBox" @click="fsaveBox(5)">No</button>
          </div>
        </section>
      </transition>
    </div>
    <script>
      let listOne = [
        {
          value: "0",
          label: "總編輯",
          image: "assets/1.gif",
          styleValue: 1,
          style: "font-weight:bold;margin-left:0",
          status: "warning",
          modify: false,
          text: "...",
          labelLink:"#總編輯"
        },
        {
          value: "0.1",
          label: "初始樣板-文件版",
          image: "assets/750x464.jpg",
          styleValue: 2,
          style: "margin-left:1rem;",
          status: "warning",
          modify: true,
          text: "...2",
          labelLink:"#初始樣板-文件版"
        },
        {
          value: "0.2",
          label: "初始樣板-CDN版",
          image: "assets/750x464.jpg",
          styleValue: 2,
          style: "margin-left:1rem;",
          status: "warning",
          modify: true,
          text: "...3",
          labelLink:"#初始樣板-CDN版"
        },
        {
          value: "1",
          label: "開始編輯",
          image: "assets/750x464.jpg",
          styleValue: 1,
          style: "font-weight:bold;margin-left:0",
          status: "warning",
          modify: true,
          text: "...4",
          labelLink:"#開始編輯"
        }
      ];
      new Vue({
        data: {
          keybo:false,
          features: true,
          messageBox: false,
          saveBox: false,
          checkSaveBox: false,
          time: "",
          inMessageBox: "",
          inSaveBox: "",
          addValue: "",
          addLabel: "",
          addImage: "",
          index: "",
          rows: [],
          listOne: listOne,
          listLight: [
            { class: "el-icon-warning", check: "warning" },
            { class: "el-icon-success", check: "success" }
          ]
        },
        methods: {
          async feachList() {
            try {
              const instance = axios.create({
                timeout: 6000,
                headers: {
                  "secret-key":
                    "$2a$10$XflNqIVbG42ADERhOMsvp.KChlqUCodB/fEQFGSdjmIfKOqonOJci"
                }
              });
              const get = await instance.get(
                "https://api.jsonbin.io/b/5dcd09ab9e3eb3638dc01524"
              );
              const { data } = get; //資料在 data 屬性
              this.listOne = data.listOne; //將GET的資料放到Vue上的groupList陣列中
            } catch (error) {
              throw new Error(error);
            }
          },
          async putList() {
            try {
              const instance = axios.create({
                timeout: 6000,
                headers: {
                  "secret-key":
                    "$2a$10$XflNqIVbG42ADERhOMsvp.KChlqUCodB/fEQFGSdjmIfKOqonOJci",
                  "Content-Type": "application/json",
                  versioning: false
                }
              });
              let data = this.listOne;
              const put = await instance.put(
                "https://api.jsonbin.io/b/5dcd09ab9e3eb3638dc01524",
                { listOne: data }
              );
            } catch (error) {
              throw new Error(error);
            }
          },
          fFeatures() {
            this.features = !this.features;
          },
          fsaveBox(val) {
            // 1 顯示
            // 3 close > 你確定不儲存此次文件修改?
            // 4         yes
            // 5         No
            // 2 Save > putList
            switch (val) {
              case 1:
                this.saveBox = true;
                this.inSaveBox = "請隨時儲存文件!";
                if (this.time) {
                  clearInterval(this.time);
                }
                this.time = setTimeout(
                  () => (
                    (this.messageBox = false),
                    (this.inMessageBox = ""),
                    this.fsaveBox(2)
                  ),
                  300000
                );
                break;
              case 2:
                this.saveBox = false;
                this.putList();
                this.fmessageBox(1, "已完成儲存文件");
                break;
              case 3:
                this.inSaveBox = "你確定不儲存修改的文件?";
                this.checkSaveBox = true;
                break;
              case 4:
                this.inSaveBox = "你確定不儲存修改的文件?";
                this.fmessageBox(1, "尚未編輯的儲存文件");
                this.saveBox = false;
                this.checkSaveBox = false;
                break;
              case 5:
                this.inSaveBox = "請隨時儲存文件!";
                this.checkSaveBox = false;
                break;
              default:
                // this.saveBox = false;
                break;
            }
          },
          fmessageBox(val, text) {
            if (val == 0) {
              this.messageBox = false;
            } else {
              this.messageBox = true;
              this.inMessageBox = text;              
              if (this.time) {
                clearInterval(this.time);
              }
              this.time = setTimeout(
                () => ((this.messageBox = false), (this.inMessageBox = "")),
                2500
              );
            }          
          },
          fFeaturesData(val, index) {
            // 1 顯示
            // 2 新增
            // 3 修改-標題
            // 4 刪除
            // 5 燈號
            // 6 左
            // 7 右
            // 8 上
            // 9 下
            // 10 修改-內文
            let p = this.listOne;
            let i = index;
            let checki = this.index;
            let vm = this;
            switch (val) {
              case 1:
                this.index = i;
                this.addValue = p[i].value;
                this.addLabel = p[i].label;
                this.addImage = p[i].image;
                this.addText = p[i].text;            
                break;
              case 2:
                if (
                  this.addValue == "" ||
                  this.addLabel == "" ||
                  this.addImage == ""
                ) {
                  this.fmessageBox(1, "尚未填滿資料");
                } else {
                  vm.rows = {
                    value: this.addValue,
                    label: this.addLabel,
                    image: this.addImage,
                    styleValue: 1,
                    style: "font-weight:bold;margin-left:0",
                    status: "warning",
                    modify: true,
                    text: "",
                    labelLink:this.anchor,
                  };
                  let r = this.listOne.length;
                  let l = listOne.filter(e => {
                    return Number(e.value) > Number(this.addValue);
                  });
                  let i = r - l;
                  p.splice(i, 0, vm.rows);
                  this.addValue = "";
                  this.addLabel = "";
                  this.addImage = "";
                  this.anchor="";
                  this.index = "";
                  this.fsaveBox(1);                  
                }
                break;
              case 3:
                if (checki === "") {
                  this.fmessageBox(1, "請點選項目 to Modify");
                } else if (
                  this.addValue == "" ||
                  this.addLabel == "" ||
                  this.addImage == ""
                ) {
                  this.fmessageBox(1, "修改資料尚未填滿");
                } else {
                  p[checki].value = this.addValue;
                  p[checki].label = this.addLabel;
                  p[checki].image = this.addImage;
                  p[checki].labelLink = this.anchor;
                  this.fsaveBox(1);
                }
                break;
              case 4:
                if (i == "") {
                  this.fmessageBox(1, "請點選項目 to Delete");
                } else {
                  p.splice(i, 1);
                  this.fsaveBox(1);
                  this.fmessageBox(1, "已刪除項目");
                }
                break;
              case 5:
                if (i === "") {
                  this.fmessageBox(1, "請點選項目 change Light");
                } else if (p[i].status == "success") {
                  p[i].status = "warning";
                  this.fsaveBox(1);
                  this.fmessageBox(1, "燈號已變換為 warning");
                } else {
                  p[i].status = "success";
                  this.fsaveBox(1);
                  this.fmessageBox(1, "燈號已變換為 success");
                }
                break;
              case 6:
                if (i === "") {
                  this.fmessageBox(1, "請點選項目位置 to Left");
                } else {
                  let style = p[i].style;
                  let styleValue = p[i].styleValue;
                  if (styleValue > 0) {
                    let newValue = --styleValue;
                    p[i].styleValue = newValue;
                    switch (newValue) {
                      case 1:
                        p[i].style = "font-weight:bold;margin-left:0";
                        break;
                      case 2:
                        p[i].style = "margin-left:1rem";
                        break;
                      case 3:
                        p[i].style = "margin-left:2rem;font-style:italic";
                        break;
                      default:
                        break;
                    }
                    this.fsaveBox(1);
                  }
                }
                break;
              case 7:
                if (i === "") {
                  this.fmessageBox(1, "請點選項目位置 to  Right");
                } else {
                  let style = p[i].style;
                  let styleValue = p[i].styleValue;
                  if (styleValue < 3) {
                    let newValue = ++styleValue;
                    p[i].styleValue = newValue;
                    switch (newValue) {
                      case 1:
                        p[i].style = "font-weight:bold;margin-left:0; ";
                        break;
                      case 2:
                        p[i].style = "margin-left:1rem;";
                        break;
                      case 3:
                        p[i].style = "margin-left:2rem;font-style:italic";
                        break;
                      default:
                        break;
                    }
                    this.fsaveBox(1);
                  }
                }
                break;
              case 8:
                if (i === "") {
                  this.fmessageBox(1, "請點選項目位置 to Top");
                } else {
                  if (i > 0) {
                    //限制 i 操作 1
                    p.splice(i - 1, 0, p[i]); //新增一個新的
                    p.splice(i + 1, 1); // 刪除原本的
                    this.index = i - 1;
                    this.fsaveBox(1);
                  }
                }
                break;
              case 9:
                if (i === "") {
                  this.fmessageBox(1, "請點選項目位置 to Down");
                } else {
                  p.splice(i + 2, 0, p[i]);
                  p.splice(i, 1);
                  this.index = i + 1;
                  this.fsaveBox(1);
                }
                break;
              case 10:
                if (i === "") {
                  this.fmessageBox(1, "請點選標題");
                } else {
                  p[i].modify = !p[i].modify;
                  if (p[i].modify === false) {
                    this.fsaveBox(1);
                  }
                }
                break;
              default:
                console.log("錯誤");
                break;
            }
          },
          fAddText() {
            let vm = this;
            vm.rows = {
              label: this.addText,
              value: "",
              style: "font-weight:bold;margin-left:0",
              modify: false,
              features: false
            };
            if (this.addText !== "") {
              vm.listOne.unshift(vm.rows);
              this.addText = "";
            }
          }         
        },
        computed: {
          anchor: function() {
            return `#${this.addLabel}`;
          }
        } ,    
        mounted() {
          this.feachList();
        },
         created() {
          //全局監聽鍵盤事件
          let vm = this;
          document.onkeydown = function(e) {
            let key = window.event.keyCode;
            if(vm.keybo){
            switch (key) {
              case 38:
                vm.fFeaturesData(8, vm.index);
                break;
              case 40:
                vm.fFeaturesData(9, vm.index);
                break;
              case 37:
                vm.fFeaturesData(6, vm.index);
                break;
              case 39:
                vm.fFeaturesData(7, vm.index);
                break;
              default:
                break;
            }
            }
          };
        }
      }).$mount("#app");
      function compareValue(a, b) {
        if (Number(a.value) < Number(b.value)) return -1;
        if (Number(a.value) > Number(a.value)) return 1;
        return 0;
      }
    </script>
  </body>
</html>
